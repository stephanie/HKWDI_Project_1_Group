"use strict";angular.module("LocalStorageModule").value("prefix","gameScore"),angular.module("tickeyApp",["LocalStorageModule","firebase"]).config(["$routeProvider",function(a){a.when("/gameboard/:number/:symbol",{templateUrl:"views/multiplayer_gameboard.html",controller:"MultiplayerGameboardCtrl"}).when("/gameboard/",{templateUrl:"views/gameboard.html",controller:"GameboardCtrl"}).when("/how",{templateUrl:"views/how.html",controller:"HowCtrl"}).when("/scoreboard",{templateUrl:"views/scoreboard.html",controller:"ScoreboardCtrl"}).when("/name",{templateUrl:"views/name.html",controller:"NameCtrl"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/match_online_player",{templateUrl:"views/match_online_player.html",controller:"MatchOnlinePlayerCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("tickeyApp").controller("MainCtrl",["$scope","$rootScope","localStorageService",function(a,b){a.name="Tickety",b.howButton=!1,b.smallPlaybutton=!0,a.clicked=function(){a.clicked=!0}}]),angular.module("tickeyApp").controller("GameboardCtrl",["$scope","$rootScope","$timeout","$location","localStorageService","angularFire",function(a,b,c,d,e,f){var g=new Firebase("https://tictactoe-leaderboard.firebaseio.com/leaderData");a.leaderData={},f(g,a,"leaderData"),a.timeleft=60,a.stoptimer,b.howButton=!1,b.smallPlaybutton=!0,a.currentSymbol="x",a.turnNum=0,a.name="Tickety",a.xScore=parseInt(e.get("storedXScore")),void 0==a.xScore,a.xScore=0,a.oScore=parseInt(e.get("storedOScore")),void 0==a.oScore,a.oScore=0,a.tieScore=parseInt(e.get("storedTieScore")),void 0==a.tieScore,a.tieScore=0,a.gameboard=["","","","","","","","",""],a.start=function(){a.stoptimer=c(function(){a.timeleft>0?(a.timeleft=a.timeleft-1,a.start()):0==a.timeleft?d.path("/scoreboard"):c.cancel(a.stoptimer)},1e3)},a.stop=function(){c.cancel(a.stoptimer)},a.turn=function(){a.turnNum+=1,1===a.turnNum&&60==a.timeleft&&a.start()},a.handleClick=function(b){if(a.notOccupied(b)){if(a.makeNextMove(b,a.currentSymbol),a.isWinning(a.currentSymbol))return alert(a.currentSymbol+" wins!"),a.addGamePoint(),a.restartGame(),void 0;9==a.turnNum?(alert("Tie!"),a.addTieGamePoint,a.restartGame()):(a.swapSymbol(),a.turnNum<9?(a.selectRandomSquare(a.currentSymbol),a.isWinning(a.currentSymbol)?(alert(a.currentSymbol+" wins!"),a.addGamePoint,a.restartGame()):a.swapSymbol()):a.swapSymbol())}},a.makeNextMove=function(b,c){a.gameboard[b]=c,a.turn()},a.swapSymbol=function(){a.currentSymbol="x"==a.currentSymbol?"o":"x"},a.notOccupied=function(b){var c=""==a.gameboard[b];return c},a.isWinning=function(b){for(var c=0;8>=c;c+=3)if(a.isSameSymbolsIn(c,c+1,c+2,b))return!0;for(var c=0;2>=c;c++)if(a.isSameSymbolsIn(c,c+3,c+6,b))return!0;return a.isDiagonalSameSymbols(b)},a.isSameSymbolsIn=function(b,c,d,e){var f=a.gameboard[b]==e,g=a.gameboard[c]==e,h=a.gameboard[d]==e,i=f&&g&&h;return i},a.isDiagonalSameSymbols=function(b){var c=a.gameboard[0]==b&&a.gameboard[4]==b&&a.gameboard[8]==b,d=a.gameboard[2]==b&&a.gameboard[4]==b&&a.gameboard[6]==b;return c||d},a.clearBoard=function(){for(var b=0;8>=b;b++)a.gameboard[b]=""},a.restartGame=function(){a.currentSymbol="x",a.turnNum=0,a.playermessage="",a.clearBoard()},a.selectRandomSquare=function(b){var c;do c=Math.floor(9*Math.random()+1);while(!a.notOccupied(c));a.makeNextMove(c,b)},a.addGamePoint=function(){"x"==a.currentSymbol?(a.xScore=a.xScore+1,e.add("xScore",a.xScore)):a.oScore=a.oScore+1},a.addTieGamePoint=function(){a.tieScore=a.tieScore+1}}]),angular.module("tickeyApp").controller("HowCtrl",["$scope","$rootScope",function(a,b){a.name="Tickety",b.howButton=!0,b.smallPlaybutton=!1}]),angular.module("tickeyApp").directive("changeColor",function(){return{restrict:"A",link:function(a,b,c){b.bind("mouseenter",function(a){b.css("color",a?"rgb(193,39,45)":c.redColor)}),b.bind("mouseleave",function(a){b.css("color",a?"black":c.blackColor),console.log("Back to black!")})}}}),angular.module("tickeyApp").controller("ScoreboardCtrl",["$scope","angularFire","$rootScope",function(a,b,c){c.howButton=!0,c.smallPlaybutton=!1;var d=new Firebase("https://tictactoe-leaderboard.firebaseio.com/");a.leaderboardData=[],b(d,a,"leaderboardData")}]),angular.module("tickeyApp").controller("MultiplayerGameboardCtrl",["$scope","$routeParams","angularFire","$rootScope",function(a,b,c,d){function e(a,b){return!(b>a||a>b)}d.howButton=!1,d.smallPlaybutton=!0,a.gameboardId=b.number,a.mySymbol=b.symbol,a.gameboard=[];var f=new Firebase("https://tictactoe-leaderboard.firebaseio.com/gameboard"+a.gameboardId);a.promise=c(f,a,"gameboard"),a.turnNum=0,a.myTurn=!1,"x"==a.mySymbol&&(a.otherPlayerSymbol="o"),"o"==a.mySymbol&&(a.otherPlayerSymbol="x"),a.promise.then(function(){a.gameboard=[],0==a.gameboard.length&&"x"==a.mySymbol?(a.playermessage="You are X. Make the first move!",a.myTurn=!0,console.log("X working.. X's turn:"+a.myTurn),console.log("The other player's symbol is "+a.otherPlayerSymbol)):(a.playermessage="You are O. Make the next move.",a.myTurn=!1,console.log("O working.. O's turn:"+a.myTurn),console.log("The other player's symbol is "+a.otherPlayerSymbol))}),f.on("value",function(b){console.log("Wait received"),a.myTurn?console.log("It is my turn"):null!=b.val()?e(b.val(),a.gameboard)?console.log("Move made on my gameboard"):(console.log("Move made on opponent's gameboard"),a.isLosing(a.otherPlayerSymbol)?(console.log("The other player won"),a.playermessage="You lost!"):a.myTurn=!0):console.log("Snapshot is empty")}),a.handleClick=function(b){console.log("Gameboard clicked"),a.myTurn&&a.notOccupied(b)&&(a.makeNextMove(b,a.mySymbol),a.isWinning(a.mySymbol)?(console.log("Registered yes to winning"),a.playermessage="You won!",a.restartGame()):8==a.turnNum?scope.playermessage="Tie!":a.myTurn=!1)},a.notOccupied=function(b){var c=null==a.gameboard[b];return console.log("notOccupied worked"),c},a.makeNextMove=function(b){a.gameboard[b]=a.mySymbol,console.log("makeNextMove worked"),a.turn()},a.isLosing=function(b){a.isWinning(b)},a.isWinning=function(b){for(var c=0;8>=c;c+=3)if(a.isSameSymbolsIn(c,c+1,c+2,b))return!0;for(var c=0;2>=c;c++)if(a.isSameSymbolsIn(c,c+3,c+6,b))return!0;return a.isDiagonalSameSymbols(b)},a.isSameSymbolsIn=function(b,c,d,e){var f=a.gameboard[b]==e,g=a.gameboard[c]==e,h=a.gameboard[d]==e,i=f&&g&&h;return i},a.isDiagonalSameSymbols=function(b){var c=a.gameboard[0]==b&&a.gameboard[4]==b&&a.gameboard[8]==b,d=a.gameboard[2]==b&&a.gameboard[4]==b&&a.gameboard[6]==b;return c||d},a.turn=function(){a.turnNum+=1},a.restartGame=function(){for(var b=0;8>=b;b++)a.gameboard[b]="",a.turnNum=0}}]),angular.module("tickeyApp").controller("MatchOnlinePlayerCtrl",["$scope","angularFire","$location","$rootScope",function(a,b,c,d){function e(){return Math.floor(372841923*Math.random()).toString(16)}d.howButton=!1,d.smallPlaybutton=!0,console.log("Loading match online"),a.waitingRoom={};var f=new Firebase("https://tictactoe-leaderboard.firebaseio.com/waitingRoom");a.promise=b(f,a,"waitingRoom"),a.createWaitingRoom=function(){a.waitingRoom={xJoined:!0,gameboardNumber:e()},a.noticeMessage="Finding an opponent...",f.on("child_removed",function(){var b=a.waitingRoom.gameboardNumber;c.path("gameboard/"+b+"/x")})},a.promise.then(function(){1==a.waitingRoom.xJoined?a.joinWaitingRoom():a.createWaitingRoom()}),a.joinWaitingRoom=function(){var b=a.waitingRoom.gameboardNumber;a.waitingRoom={},c.path("gameboard/"+b+"/o")}}]);